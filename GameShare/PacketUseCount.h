/*$T Common/Utilities/PacketUseCount.h GC 1.140 10/10/07 10:06:57 */


/*$6
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 */


#ifndef PacketUseCount_h__15_12_2008_15_51
#define PacketUseCount_h__15_12_2008_15_51


class	PacketUseCount
{
	enum SORT_TYPE { PUC_SORT_SEND_COUNT = 0, PUC_SORT_SIZE_COUNT };
	struct PacketInfomation
	{
		int32	iPacketID;
		uint32	iPacketSendCount;
		uint32	iPacketSizeCount;
	};

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
public:
	void	Reset();

	void	SetActive(MapID_t iSceneID);

	void	SaveInfoToLogFile(int32 iType);

	void	CacheInfomation(int32 iSize, int32 iPacketID, MapID_t iSceneID);

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
private:
	void		Sort(int32 iType);
	static int32	CompareBySendCount(const void *pArg1, const void *pArg2);
	static int32	CompareBySizeCount(const void *pArg1, const void *pArg2);

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
private:
	PacketUseCount();
	~	PacketUseCount();

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
private:
	MapID_t			m_iSceneID;
	FastLock		m_Lock;

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
public:
	static PacketUseCount	*GetInstance();

	static void		CreateInstance();

	static void		DeleteInstance();

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
private:
	static PacketUseCount	*m_pInstance;
};
#endif
