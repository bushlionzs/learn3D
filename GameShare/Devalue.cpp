/*$T Common/EncryptAriths/Devalue.cpp GC 1.140 10/10/07 10:06:29 */


/*$6
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 */


#include "stdafx.h"
#include "Devalue.h"

/*
 =======================================================================================================================
 =======================================================================================================================
 */

void DevalueBase::SetUserKey(const uchar *key)
{
	m_BlockLen = BUFSIZE;
	memset(m_szUserKey, 0, KEYLENGTH);
	memcpy(m_szUserKey, key, KEYLENGTH);
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void DevalueEncryption::SetUserKey(const uchar *key)
{
	DevalueBase::SetUserKey(key);
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void DevalueEncryption::ProcessBlock(const uchar *in, uchar *out) const
{
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
	uint32	userKey = (uint32) atoi(m_szUserKey);
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

	userKey = userKey % BUFSIZE;

	for(int32 num = 0; num < BUFSIZE; ++num)
	{
		out[num] = in[num] - userKey;
	}
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void DevalueDecryption::SetUserKey(const uchar *key)
{
	DevalueBase::SetUserKey(key);
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void DevalueDecryption::ProcessBlock(const uchar *in, uchar *out) const
{
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
	uint32	userKey = (uint32) atoi(m_szUserKey);
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

	userKey = userKey % BUFSIZE;

	for(int32 num = 0; num < BUFSIZE; ++num)
	{
		out[num] = in[num] + userKey;
	}
}
