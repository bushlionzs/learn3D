#include "stdafx.h"
#include <OgreException.h>
#include "GameResourceLoad.h"
#include "OgreResourceManager.h"
#include "OgreDataStream.h"

template<>
CResourceLoad * Ogre::Singleton<CResourceLoad>::msSingleton = NULL;

/*
 =======================================================================================================================
 =======================================================================================================================
 */

CResourceLoad *CResourceLoad::GetSingletonPtr(void)
{
	return msSingleton;
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
CResourceLoad &CResourceLoad::GetSingleton(void)
{
	KLAssert(msSingleton);
	return(*msSingleton);
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
CResourceLoad::CResourceLoad(void)
{
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
CResourceLoad::~CResourceLoad(void)
{
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
KHAN_RETURN_RESULT CResourceLoad::Initialize(void)
{
	return KRR_SUCCEED;
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
KHAN_RETURN_RESULT CResourceLoad::Update(void)
{
	return KRR_SUCCEED;
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void CResourceLoad::Release(void)
{
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
DWORD CResourceLoad::Load(LPCTSTR szFileName, LPSTR &szMem, LPCTSTR szResGroup)
{
	if(szFileName == NULL || strlen(szFileName) == 0) return 0;

	Ogre::DataStreamPtr stream = ResourceManager::getSingleton().openResource(szFileName, szResGroup);

	if (stream)
	{
		
		szMem = new char[stream->getStreamLength() + 1];
		stream.get()->read(szMem, stream->getStreamLength());
		szMem[stream->getStreamLength()] = 0;

		return(DWORD)stream->getStreamLength();
	}
	

	return 0;
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
BOOL CResourceLoad::UnLoad(LPSTR szMem, DWORD dwSize)
{
	if(szMem) delete[] szMem;
	szMem = NULL;

	return TRUE;
}
