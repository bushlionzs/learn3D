/*$T Common/ScriptCacheMgr.h GC 1.140 10/10/07 10:06:30 */


/*$6
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 */


/* ScriptCacheMgr.h 功能说明： */
#ifndef _FILE_DATA_MGR_H_
#define _FILE_DATA_MGR_H_

#include "TypeDefine.h"
#include <stdio.h>

#define FILE_DATA_NAME_LEN	(128)
#define AUTO_ARRAY_MODE_MAX_LEN (4096)

struct ScriptCache
{
public:
	ScriptCache (void);
	virtual~ScriptCache (void);

	virtual BOOL	Init(uint32 uID, char *pszFileName, FILE *fp);
	virtual void	Term(void);
public:

	/*
	 ===============================================================================================================
	 ===============================================================================================================
	 */
	int32 GetID(void) const
	{
		return m_uID;
	}

	/*
	 ===============================================================================================================
	 ===============================================================================================================
	 */
	const char *GetFileName(void) const
	{
		return m_szFileName;
	}

protected:
	int32	m_uID;
	char	m_szFileName[FILE_DATA_NAME_LEN];
};

class	ScriptCacheMgr
{
/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
public:
	ScriptCacheMgr(void);
	virtual		~ScriptCacheMgr(void);

	BOOL		Init(const char *pszPathFileName, BOOL bForceArrayMode);

	void		Term(void);

	ScriptCache	*GetFileData(uint32 uID);
	const ScriptCache *GetConstFileData(uint32 uID) const;

	/*
	 ===============================================================================================================
	 ===============================================================================================================
	 */

	int32 GetCount()
	{
		return m_uCount;
	}

	ScriptCache	*GetFileDataByIndex(int32 nIndex);

	/*
	 ===============================================================================================================
	 ===============================================================================================================
	 */

	BOOL IsInit()
	{
		return m_bInit;
	}

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
protected:
	static int32	CompareOfFileDataID(const void *pArg1, const void *pArg2);
	BOOL		ReadTabSizeCheck(int32 iTableCount);
	void		SortFileDataArray();

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
private:
	BOOL		m_bInit;
	int32		m_uCount;
	ScriptCache	*m_apFileData;
};
#endif
