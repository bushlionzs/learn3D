/*$T Common/Utilities/PacketUseCount.cpp GC 1.140 10/10/07 10:06:57 */


/*$6
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 */


#include "stdafx.h"
#include "PacketUseCount.h"

PacketUseCount *PacketUseCount::	m_pInstance = NULL;
const int32				PACKET_COUNT_MARK = 100000;

/*
 =======================================================================================================================
 =======================================================================================================================
 */

void PacketUseCount::Reset()
{

	m_iSceneID = INVALID_ID;
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
PacketUseCount::PacketUseCount()
{
	Reset();
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
PacketUseCount::~PacketUseCount()
{
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void PacketUseCount::SetActive(MapID_t iSceneID)
{
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
	__GUARD__ std::lock_guard<FastLock>	autolock(m_Lock);
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

	Reset();
	m_iSceneID = iSceneID;
	__UNGUARD__
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void PacketUseCount::SaveInfoToLogFile(int32 iType)
{
	
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void PacketUseCount::CacheInfomation(int32 iSize, int32 iPacketID, MapID_t iSceneID)
{
	
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
PacketUseCount *PacketUseCount::GetInstance()
{
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
	__GUARD__	KCheck(NULL != m_pInstance);
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

	return m_pInstance;
	__UNGUARD__ return NULL;
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void PacketUseCount::CreateInstance()
{
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
	__GUARD__	KCheck(NULL == m_pInstance);
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

	m_pInstance = new PacketUseCount;
	KCheck(NULL != m_pInstance);
	__UNGUARD__
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void PacketUseCount::DeleteInstance()
{
	__GUARD__ if(NULL != m_pInstance)
	{
		delete m_pInstance;
		m_pInstance = NULL;
	}

	__UNGUARD__
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
void PacketUseCount::Sort(int32 iType)
{
	
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
int32 PacketUseCount::CompareBySendCount(const void *pArg1, const void *pArg2)
{
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
	__GUARD__ int32		Serial1, Serial2;
	PacketInfomation	*pCount1 = (PacketInfomation *) pArg1;
	PacketInfomation	*pCount2 = (PacketInfomation *) pArg2;
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

	Serial1 = pCount1->iPacketSendCount;
	Serial2 = pCount2->iPacketSendCount;

	if(Serial1 > Serial2)
	{
		return -1;
	}
	else if(Serial1 < Serial2)
	{
		return 1;
	}
	else
	{
		return 1;
	}

	__UNGUARD__ return 0;
}

/*
 =======================================================================================================================
 =======================================================================================================================
 */
int32 PacketUseCount::CompareBySizeCount(const void *pArg1, const void *pArg2)
{
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
	__GUARD__ int32		Serial1, Serial2;
	PacketInfomation	*pCount1 = (PacketInfomation *) pArg1;
	PacketInfomation	*pCount2 = (PacketInfomation *) pArg2;
	/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/

	Serial1 = pCount1->iPacketSizeCount;
	Serial2 = pCount2->iPacketSizeCount;

	if(Serial1 > Serial2)
	{
		return -1;
	}
	else if(Serial1 < Serial2)
	{
		return 1;
	}
	else
	{
		return 1;
	}

	__UNGUARD__ return 0;
}
