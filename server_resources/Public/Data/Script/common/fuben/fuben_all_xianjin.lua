-------------------------------------------------
-- 现金副本
-------------------------------------------------
x700079_g_ScriptId = 700079



x700079_g_Fuben_list = { 
							{weekday =0 ,name="【队伍】五番藏宝洞（金钱）",		scriptid = 700099, starttime=0*60+0, endtime=24*60, levelmin=25, levelmax=160},
							{weekday =1 ,name="【队伍】五番藏宝洞（声望）",	scriptid = 700098, starttime=0*60+0, endtime=24*60, levelmin=25, levelmax=160},
							{weekday =2 ,name="【队伍】五番藏宝洞（水晶）",		scriptid = 700029, starttime=0*60+0, endtime=24*60, levelmin=25, levelmax=160},
							{weekday =3 ,name="【队伍】五番藏宝洞（龙眼石）",		scriptid = 700097, starttime=0*60+0, endtime=24*60, levelmin=30, levelmax=160},
							{weekday =4 ,name="【队伍】五番藏宝洞（图谱）",		scriptid = 700100, starttime=0*60+0, endtime=24*60, levelmin=40, levelmax=160},
							{weekday =5 ,name="【队伍】五番藏宝洞（材料）",		scriptid = 700101, starttime=0*60+0, endtime=24*60, levelmin=50, levelmax=160},
							
						}



x700079_g_Fuben_EnterInfoList = {
									"\t传说佛祖释迦摩尼涅之后，留下六颗真身舍利，其中一舍利，多方辗转，最终被一位高僧镶嵌在藏宝洞一座大佛的佛头中，可是，自从察合台汗国的那一帮败类来到了王城，他们整日打着黄金家族后裔的幌子，百方打探得知了藏宝洞的位置，并派遣大量人手进入其中，欲盗取佛祖舍利。\n\t百年前我们耶律家族曾追随大汗征战四方，如今我们也不能坐视这宝物落入歹人之手！\n#Y开放时间：#W每周日开放\n#Y友情提示：#W3人以上的队伍，才能进入该副本！#G同时每人需上交1个五番令！\n#Y副本说明：#W完成一次本副本，你可以获得#G所有普通藏宝洞（金钱）副本的金钱奖励！但也将消耗您一天所有可进入的藏宝洞（金钱）副本次数！",
									"\t传说佛祖释迦摩尼涅之后，留下六颗真身舍利，其中一舍利，多方辗转，最终被一位高僧镶嵌在藏宝洞一座大佛的佛头中，可是，自从察合台汗国的那一帮败类来到了王城，他们整日打着黄金家族后裔的幌子，百方打探得知了藏宝洞的位置，并派遣大量人手进入其中，欲盗取佛祖舍利。\n\t百年前我们耶律家族曾追随大汗征战四方，如今我们也不能坐视这宝物落入歹人之手！\n#Y开放时间：#W每周一开放\n#Y友情提示：#W3人以上的队伍，才能进入该副本！#G同时每人需上交1个五番令！\n#Y副本说明：#W完成一次本副本，你可以获得#G所有普通藏宝洞（声望）副本的声望奖励！但也将消耗您一天所有可进入的藏宝洞（声望）副本次数！",
									"\t传说佛祖释迦摩尼涅之后，留下六颗真身舍利，其中一舍利，多方辗转，最终被一位高僧镶嵌在藏宝洞一座大佛的佛头中，可是，自从察合台汗国的那一帮败类来到了王城，他们整日打着黄金家族后裔的幌子，百方打探得知了藏宝洞的位置，并派遣大量人手进入其中，欲盗取佛祖舍利。\n\t百年前我们耶律家族曾追随大汗征战四方，如今我们也不能坐视这宝物落入歹人之手！\n#Y开放时间：#W每周二开放\n#Y友情提示：#W3人以上的队伍，才能进入该副本！#G同时每人需上交1个五番令！\n#Y副本说明：#W完成一次本副本，你可以获得#G所有普通藏宝洞（水晶）副本的水晶奖励！但也将消耗您一天所有可进入的藏宝洞（水晶）副本次数！",
									"\t传说佛祖释迦摩尼涅之后，留下六颗真身舍利，其中一舍利，多方辗转，最终被一位高僧镶嵌在藏宝洞一座大佛的佛头中，可是，自从察合台汗国的那一帮败类来到了王城，他们整日打着黄金家族后裔的幌子，百方打探得知了藏宝洞的位置，并派遣大量人手进入其中，欲盗取佛祖舍利。\n\t百年前我们耶律家族曾追随大汗征战四方，如今我们也不能坐视这宝物落入歹人之手！\n#Y开放时间：#W每周三开放\n#Y友情提示：#W3人以上的队伍，才能进入该副本！#G同时每人需上交1个五番令！\n#Y副本说明：#W完成一次本副本，你可以获得#G所有普通藏宝洞（龙眼石）副本的龙眼石奖励！但也将消耗您一天所有可进入的藏宝洞（龙眼石）副本次数！",
									"\t传说佛祖释迦摩尼涅之后，留下六颗真身舍利，其中一舍利，多方辗转，最终被一位高僧镶嵌在藏宝洞一座大佛的佛头中，可是，自从察合台汗国的那一帮败类来到了王城，他们整日打着黄金家族后裔的幌子，百方打探得知了藏宝洞的位置，并派遣大量人手进入其中，欲盗取佛祖舍利。\n\t百年前我们耶律家族曾追随大汗征战四方，如今我们也不能坐视这宝物落入歹人之手！\n#Y开放时间：#W每周四开放\n#Y友情提示：#W3人以上的队伍，才能进入该副本！#G同时每人需上交1个五番令！\n#Y副本说明：#W完成一次本副本，你可以获得#G所有普通藏宝洞（图谱）副本的图谱奖励！但也将消耗您一天所有可进入的藏宝洞（图谱）副本次数！" ,
									"\t传说佛祖释迦摩尼涅之后，留下六颗真身舍利，其中一舍利，多方辗转，最终被一位高僧镶嵌在藏宝洞一座大佛的佛头中，可是，自从察合台汗国的那一帮败类来到了王城，他们整日打着黄金家族后裔的幌子，百方打探得知了藏宝洞的位置，并派遣大量人手进入其中，欲盗取佛祖舍利。\n\t百年前我们耶律家族曾追随大汗征战四方，如今我们也不能坐视这宝物落入歹人之手！\n#Y开放时间：#W每周五开放\n#Y友情提示：#W3人以上的队伍，才能进入该副本！#G同时每人需上交1个五番令！\n#Y副本说明：#W完成一次本副本，你可以获得#G所有普通藏宝洞（材料）副本的材料奖励！但也将消耗您一天所有可进入的藏宝洞（材料）副本次数！",
									
								 }



function x700079_ProcEventEntry(sceneId, selfId, NPCId, MissionId,nIndex)	--点击该任务后执行此脚本
	
	
	if GetGameOpenById(1022)<=0 then
		x700079_ShowTips(sceneId, selfId, "此活动已关闭")
		return 0
	end

	if nIndex==nil then
		return 0
	end

	
	x700079_DispatchXianJinFubenInfo( sceneId, selfId, NPCId,nIndex )
	
end


--**********************************

--列举事件

--**********************************

function x700079_ProcEnumEvent(sceneId, selfId, NPCId, MissionId)

	if GetGameOpenById(1022)<=0 then
		
		return 0;
	end
	
	if IsPlayerStateNormal(sceneId,selfId ) <= 0 then
		return
	end


	local nIndex, strName = x700079_GetFubenName(sceneId, selfId)


	if nIndex<=0 then
		return
	end


	local nLevel  = GetLevel(sceneId,selfId)

	if nLevel>=x700079_g_Fuben_list[nIndex].levelmin and nLevel<=x700079_g_Fuben_list[nIndex].levelmax then
		AddQuestNumText(sceneId, x700079_g_ScriptId, strName,14,nIndex)
	end

	

	
	
	
			
end

function x700079_GetFubenName(sceneId, selfId)

	local nIndex =0
	
	local dayweek = GetWeek()
	for i, item in x700079_g_Fuben_list do
		nIndex = nIndex+1
		if dayweek==item.weekday then
			
			local hour,minute,sec =GetHourMinSec();
			local nowtime = hour*60+minute
	
	
			if nowtime >= item.starttime and nowtime <= item.endtime then
			
				return nIndex,item.name
				
			end
			
			
		end
	end

	return -1," "
	
end






function x700079_DispatchXianJinFubenInfo( sceneId, selfId, NPCId, nIndex )

	SetQuestData(sceneId, selfId, MD_XIANJIN_FUBEN_TALK_PARAM[1], MD_XIANJIN_FUBEN_TALK_PARAM[2],MD_XIANJIN_FUBEN_TALK_PARAM[3], nIndex );
	
	BeginQuestEvent(sceneId)

		
		AddQuestText(sceneId,"#Y"..x700079_g_Fuben_list[nIndex].name)
		AddQuestText(sceneId,x700079_g_Fuben_EnterInfoList[nIndex])
		
		

	EndQuestEvent()





	DispatchQuestInfo(sceneId, selfId, NPCId, x700079_g_ScriptId, -1);

	
	
end


---------------------------------------------------------------------------------------------------
--申请进入副本
---------------------------------------------------------------------------------------------------
function x700079_ProcAcceptCheck( sceneId, selfId, NPCId )

	if GetGameOpenById(1022)<=0 then
		
		return 0
	end

    return 1
end

----------------------------------------------------------------------------------------------
--点确定后
----------------------------------------------------------------------------------------------
function x700079_ProcAccept( sceneId, selfId )

	
	if GetGameOpenById(1022)<=0 then
		
		return 0
	end

	x700079_OnNpcTalkEnterFuben_XJ( sceneId, selfId)
	
end


------------------------------------------------------------------------
-- 领取buff接口
----------------------------------------------------------------------

function x700079_OnNpcTalkEnterFuben_XJ( sceneId, selfId)

	if GetGameOpenById(1022)<=0 then
		x700079_ShowTips(sceneId, selfId, "此活动已关闭")
		return 0
	end

	local nIndex = GetQuestData(sceneId, selfId, MD_XIANJIN_FUBEN_TALK_PARAM[1], MD_XIANJIN_FUBEN_TALK_PARAM[2],MD_XIANJIN_FUBEN_TALK_PARAM[3] );

	local nIndex2, strName = x700079_GetFubenName(sceneId, selfId)

	

	if nIndex==nIndex2 then
		CallScriptFunction(FUBEN_COMMON_SCRIPT, "OnRequestEnterFuben", sceneId, selfId, 1, 0, x700079_g_Fuben_list[nIndex].scriptid);
	else
		x700079_ShowTips(sceneId, selfId, "现在不能进入"..x700079_g_Fuben_list[nIndex].name)
	end

	
end


function x700079_ShowTips(sceneId, selfId, str)
	BeginQuestEvent(sceneId);
		AddQuestText(sceneId,str);
	EndQuestEvent();
	DispatchQuestTips(sceneId, selfId);
end
