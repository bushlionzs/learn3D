/*$T MapServer/Server/Obj/ItemInstanceManager.h GC 1.140 10/10/07 10:07:31 */


/*$6
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 */


#ifndef _OBJ_ITEM_MANAGER_H_
#define _OBJ_ITEM_MANAGER_H_
#include "TypeDefine.h"
#include "Item_Base.h"

class	GameMap;
class	ItemInstance;
class	ItemInstanceManager
{
/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
public:
	ItemInstanceManager();
	~	ItemInstanceManager();

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
public:
	void		Init();

	void		Clear();

	virtual BOOL	HeartBeat(uint32 uTime = 0);

	BOOL		Add(ItemInstance *pItem);

	BOOL		Remove(ObjID_t ObjID);

	ItemInstance	*GenObj_Item();

	void		RecycleObj_Item(ObjID_t ObjID);

	/*
	 ===============================================================================================================
	 ===============================================================================================================
	 */

	void SetScene(GameMap *pMap)
	{
		KCheck(pMap);
		m_pScene = pMap;
	};

	/*
	 ===============================================================================================================
	 ===============================================================================================================
	 */

	GameMap *GetMap()
	{
		return m_pScene;
	};

	BOOL		Resize(uint32 iSize);

	ItemInstance	*GetObj_Item(ObjID_t ObjID);

	BOOL		RemoveAllObj_Item(void);

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
public:
	Obj_ItemContaner	CaculateItemDropFromMonster
				(
					uint32	iKillerLevel,
					uint32	iMonsterID,
					float	fControlValue,
					int32	iFadeoutType
				);

	ItemInstance		*CreateMonsterDropObj_Item(GLPos *pPos, SItem *item);

	ItemInstance		*CreatePersonDropItemInstance(GLPos *pPos, SItem *pItem);

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
private:
	CTinyTimer	m_LogicTimer;

/*
 -----------------------------------------------------------------------------------------------------------------------
 -----------------------------------------------------------------------------------------------------------------------
 */
private:
	ObjID_t *m_pObj_ItemID;

	uint32	m_TotalSize;

	uint32	m_Count;

	GameMap*m_pScene;
};
#endif
