--功能：boss系统

--脚本号
x310000_g_ScriptId = 310000


x310000_g_CreatePositions = {
								{SceneId=	2	,pos={{posX=	192	,posZ=	77 },{posX=	192 ,posZ=  77 },{posX=	192	,posZ=	77 }}	,MonsterType=	3201	,count=	1	,ai=	1	,aiscript=	975, title="大河之王"    },--	札木合
								{SceneId=	3	,pos={{posX=	128	,posZ=	45 },{posX=	128	,posZ=	45 },{posX=	128	,posZ=	45 }}	,MonsterType=	9780	,count=	1	,ai=	1	,aiscript=	975, title="黑水之王"	},	--	籍辣思义
								{SceneId=	3	,pos={{posX=    128 ,posZ=  204},{posX=	128 ,posZ=	204},{posX=	128 ,posZ=	204}}	,MonsterType=	3204	,count=	1	,ai=	1	,aiscript=	970, title="波西米亚之王"	},	--	瓦茨拉夫一世
								{SceneId=	3	,pos={{posX=    128 ,posZ=  128},{posX=	128 ,posZ=	128},{posX=	128 ,posZ=	128}}	,MonsterType=	9781	,count=	1	,ai=	1	,aiscript=	975, title="贺兰山之王"	},	--	高逸   
								{SceneId=	4	,pos={{posX=	142	,posZ=	48 },{posX=	142	,posZ=	48 },{posX=	142	,posZ=	48 }}	,MonsterType=	3209	,count=	1	,ai=	1	,aiscript=	970, title="雪山之王"	 },	--	蒲和万奴
								{SceneId=	5	,pos={{posX=	47	,posZ=	179},{posX=	47	,posZ=  179},{posX=	47	,posZ=	179}}	,MonsterType=	3210	,count=	1	,ai=	1	,aiscript=	975, title="戈壁之王"	 },	--	胡沙虎
								{SceneId=	6	,pos={{posX=	65	,posZ=	141},{posX=	65	,posZ=	141},{posX=	65	,posZ=	141}}	,MonsterType=	3208	,count=	1	,ai=	1	,aiscript=	975, title="平原之王"	 },	--	完颜洪烈 
								{SceneId=	7	,pos={{posX=	161	,posZ=	40 },{posX=	161	,posZ=	40 },{posX=	161	,posZ=	40 }}	,MonsterType=	3217	,count=	1	,ai=	1	,aiscript=	972, title="高加索之王"	 },	--	八赤蛮
								{SceneId=	8	,pos={{posX=	188	,posZ=	206},{posX=	188	,posZ=	206},{posX=	188	,posZ=	206}}	,MonsterType=	3200	,count=	1	,ai=	1	,aiscript=	975, title="沙漠之王"	 },	--	太阳汗 
								{SceneId=	9	,pos={{posX=	49	,posZ=	103},{posX=	49	,posZ=	103},{posX=	49	,posZ=	103}}	,MonsterType=	3211	,count=	1	,ai=	1	,aiscript=	976, title="西域之王"	 },	--	屈出律 
								{SceneId=	10	,pos={{posX=	103	,posZ=	190},{posX=	103	,posZ=	190},{posX=	103	,posZ=	190}}	,MonsterType=	3212	,count=	1	,ai=	1	,aiscript=	971, title="死海之王"  },	--	摩诃魔 
								{SceneId=	13	,pos={{posX=	87	,posZ=	155},{posX=	87	,posZ=	155},{posX=	87	,posZ=	155}}	,MonsterType=	3214	,count=	1	,ai=	1	,aiscript=	977, title="巴格达之王"	 },	--	哈里发穆斯塔欣
								{SceneId=	16	,pos={{posX=	92	,posZ=	191},{posX=	92	,posZ=	191},{posX=	92	,posZ=	191}}	,MonsterType=	3213	,count=	1	,ai=	1	,aiscript=	973, title="恒河之王"    },	--	扎兰丁											
								{SceneId=	76	,pos={{posX=	211	,posZ=	203},{posX=	211	,posZ=	203},{posX=	211	,posZ=	203}}	,MonsterType=	9782	,count=	1	,ai=	1	,aiscript=	975, title="叶密立之王"	 },	--	耶律直鲁古  
								{SceneId=	176	,pos={{posX=	43	,posZ=	45},{posX=	43	,posZ=	45},{posX=	43	,posZ=	45}}	,MonsterType=	3207	,count=	1	,ai=	1	,aiscript=	973, title="鲜血之王"	},	--	德古拉公爵 
								{SceneId=	276	,pos={{posX=	211	,posZ=	203},{posX=	211	,posZ=	203},{posX=	211	,posZ=	203}}	,MonsterType=	3206	,count=	1	,ai=	1	,aiscript=	974, title="幕府之王"	 },	--	北条时宗
								{SceneId=	376	,pos={{posX=	43	,posZ=	45},{posX=	43	,posZ=	45},{posX=	43	,posZ=	45}}	,MonsterType=	9783	,count=	1	,ai=	1	,aiscript=	976, title="漠北之王"	 },	--	桑昆
								{SceneId=	11	,pos={{posX= 83	,posZ= 225},{posX= 83	,posZ= 225},{posX= 83	,posZ= 225}}	,MonsterType=	9784	,count=	1	,ai=	1	,aiscript=	976, title="撒马尔罕之王"  },	--	亦纳勒术
							 
							}

x310000_g_CreatePositions1 = {
								{SceneId=	17	,pos={{posX= 77	,  posZ= 181  },{posX= 77	,posZ= 181},{posX= 77	,posZ= 181}}	,MonsterType=	3215	,count=	1	,ai=	1	,aiscript=	970, title="顿河之王"  },	--	弗拉基米尔大公 
								{SceneId=	18	,pos={{posX= 217	,posZ= 118},{posX= 217	,posZ= 118},{posX= 217	,posZ= 118}}	,MonsterType=	3216	,count=	1	,ai=	1	,aiscript=	971, title="伏尔加之王"  },	--	基辅大公 
								{SceneId=	19	,pos={{posX= 130	,posZ= 225},{posX= 130	,posZ= 225},{posX= 130	,posZ= 225}}	,MonsterType=	3202	,count=	1	,ai=	1	,aiscript=	975, title="波兰之王"  },	--	亨利二世
								{SceneId=	21	,pos={{posX= 66	,    posZ= 222},{posX= 66	,posZ= 222},{posX= 66	,posZ= 222}}	,MonsterType=	9785	,count=	1	,ai=	1	,aiscript=	972, title="条顿之王"  },	--	绯烈特一世
								{SceneId=	22	,pos={{posX= 122	,posZ= 191},{posX= 122	,posZ= 191},{posX= 122	,posZ= 191}}	,MonsterType=	9786	,count=	1	,ai=	1	,aiscript=	976, title="哈布斯堡之王"  },	--	鲁道夫一世
								{SceneId=	23	,pos={{posX= 217	,posZ= 182},{posX= 217	,posZ= 182},{posX= 217	,posZ= 182}}	,MonsterType=	9787	,count=	1	,ai=	1	,aiscript=	975, title="大马士革之王"  },	--	拜巴尔
								{SceneId=	24	,pos={{posX= 43	,     posZ= 36},{posX= 43	, posZ= 36},{posX= 43	, posZ= 36}}	,MonsterType=	9788	,count=	1	,ai=	1	,aiscript=	974, title="圣域之王"  },	--	英诺森四世							  
								{SceneId=	20	,pos={{posX= 230	,posZ= 126},{posX= 230	,posZ= 126},{posX= 230	,posZ= 126}}	,MonsterType=	3203	,count=	1	,ai=	1	,aiscript=	971, title="匈牙利之王"	 },	--	贝拉四世 
								{SceneId=	25	,pos={{posX= 176	,posZ= 138},{posX= 176	,posZ= 138},{posX= 176	,posZ= 138}}	,MonsterType=	3205 	,count=	1	,ai=	1	,aiscript=	974, title="埃及之王"	 },	--	忽都思苏丹
								}
--//add for弱国任务开启条件
x310000_g_CreateDay = 0
x310000_g_KillCount19 = 0



function x310000_OnTimerDoingStart( SceneId, actId, Param1, Param2, Param3, Param4, Param5 )
	if SceneId ~= 2 and SceneId ~= 3 and SceneId ~= 4 and SceneId ~= 5 and SceneId ~=6 and SceneId ~= 7 and SceneId ~=8 and 
		SceneId ~= 9 and SceneId ~= 10 and SceneId ~=11 and SceneId ~= 13 and SceneId ~= 16 and SceneId ~= 76 and SceneId ~= 176 and SceneId ~=276 and SceneId ~=376 and SceneId ~=17 and SceneId ~=18 and SceneId ~=19 and SceneId ~=20  and SceneId ~=21 and SceneId ~=22 and SceneId ~=23 and SceneId ~=24 and SceneId ~=11 and SceneId ~=25 then
			return
	end
	for i, item in x310000_g_CreatePositions do
		if item.SceneId == SceneId then
			-- 开始创建NPC
			for j=1, item.count do
					local r = random(1,3)
					if r < 1 then 
						r = 1 
					end
					if r > 3 then 
						r = 3
					end
					local pos = item.pos[r]
					
					local rx = random(-3,3)
					local x = pos.posX + rx
					local rz = random(-3,3)
					local z = pos.posZ + rz
					local objId, objGuid =CreateMonster( SceneId, item.MonsterType, x, z, item.ai, item.aiscript, x310000_g_ScriptId, -1, 21, 60*60*1000, 0, "", item.title)
			end	
		end
	end

	for i, item in x310000_g_CreatePositions1 do
		if item.SceneId == SceneId then
			-- 开始创建NPC
			for j=1, item.count do
					local r = random(1,3)
					if r < 1 then 
						r = 1 
					end
					if r > 3 then 
						r = 3
					end
					local pos = item.pos[r]
					
					local rx = random(-3,3)
					local x = pos.posX + rx
					local rz = random(-3,3)
					local z = pos.posZ + rz
					local objId, objGuid =CreateMonster( SceneId, item.MonsterType, x, z, item.ai, item.aiscript, x310000_g_ScriptId, -1, 21, 60*60*1000, 0, "", item.title)
			end	
		end
	end	
	
	x310000_g_CreateDay = GetDayOfYear()
	x310000_g_KillCount19 = 0
	SetCountryQuestData(SceneId, 0, CD_INDEX_MOJUN_KILL_COUNT, 0)
end


function x310000_OnDie(sceneId, selfId, killerId)
	
	if IsObjValid( sceneId,killerId ) ~=1 then
		return
	end
	
	local title = GetMonsterTitle(sceneId, selfId)
	local nKillerType = GetObjType(sceneId, killerId)
	local nOwnerId = killerId
	if nKillerType== 3 then
		nOwnerId = GetOwnerID(sceneId, killerId)		
	end
	local killerName = GetName(sceneId, nOwnerId)
	local countryId = GetCurCountry(sceneId, nOwnerId)
	local countryName = GetCountryName(countryId)

	local msg1 = title.."已成功被"..countryName..killerName.."击败！"
	local msg2 = title.."已被击败！"

	if  sceneId >= 2 and sceneId<= 351 then
		LuaAllScenceM2Wrold(sceneId, msg1, CHAT_PLANE_SCROLL, 1)
		LuaAllScenceM2Wrold(sceneId, msg1, CHAT_LEFTDOWN, 1)
		LuaAllScenceM2Wrold(sceneId, msg2, CHAT_MAIN_RIGHTDOWN, 1)
	-- else
		-- LuaAllScenceM2Country(sceneId, msg1, countryId, CHAT_PLANE_SCROLL, 1)
		-- LuaAllScenceM2Country(sceneId, msg1, countryId, CHAT_LEFTDOWN, 1)
		-- LuaAllScenceM2Country(sceneId, msg2, countryId, CHAT_MAIN_RIGHTDOWN, 1)
	end

	GamePlayScriptLog(sceneId, killerId, 501)

	local myGuid = GetPlayerGUID( sceneId,nOwnerId )
	--//弱国任务开启条件
	-- if(x310000_g_CreateDay == GetDayOfYear()) then
		-- if sceneId==3 then
			-- x310000_g_KillCount19 = x310000_g_KillCount19 +1
			
			-- if x310000_g_KillCount19>=3 then
				
				-- GetCountryQuestDataNM(sceneId,myGuid,0, CD_INDEX_RUOGUO_START_FLAG, x310000_g_ScriptId,-1,"OnGetRuoGuoFlag",1)
				-- 不根据CD_INDEX_RUOGUO_START_FLAG的值决定是否开启世界杯，相当于GM指令的开启。只在世界杯关闭时起作用，如果已经开启调用无效
                -- ToggleWorldCup( 1)
                -- WriteLog( 1, "WCL: World cup has been actived. " )
				
			-- end
			
		-- end
	-- end
	
	if  GetMonsterDataID( sceneId,selfId )  == 3237 and  sceneId == 3 then
		local msg3 ="海都大王已被击败！"
		LuaAllScenceM2Wrold(sceneId, msg3, CHAT_PLANE_SCROLL, 1)
		LuaAllScenceM2Wrold(sceneId, msg3, CHAT_LEFTDOWN, 1)
		LuaAllScenceM2Wrold(sceneId, msg3, CHAT_MAIN_RIGHTDOWN, 1)
                GamePlayScriptLog(sceneId, killerId, 1531)
	else
		local mojunId = GetMonsterDataID( sceneId,selfId )
		for i, item in x310000_g_CreatePositions do
			if item.MonsterType == mojunId then
				if  GetMonsterDataID( sceneId,selfId ) == 3203 and  sceneId == 3 then
					SetCountryQuestData(sceneId, 0, CD_INDEX_MOJUN_KILL_COUNT1, 1)
				elseif  GetMonsterDataID( sceneId,selfId ) == 3204 and  sceneId == 3 then
					SetCountryQuestData(sceneId, 0, CD_INDEX_MOJUN_KILL_COUNT2, 1)
				elseif  GetMonsterDataID( sceneId,selfId ) == 3205 and  sceneId == 3 then
					SetCountryQuestData(sceneId, 0, CD_INDEX_MOJUN_KILL_COUNT3, 1)
				end
		
				if GetWeek() == 6 then
					SetCountryQuestData(sceneId, 0, CD_INDEX_MOJUN_KILL_COUNT, 1,1)
		
					GetCountryQuestDataNM(sceneId,myGuid,0, CD_INDEX_MOJUN_KILL_COUNT, x310000_g_ScriptId,3,"OnMoJunFlag",2)
				end
				return
			end
		end
	end
			
end

--//得到弱国任务是否开启
function x310000_OnGetRuoGuoFlag(sceneId, selfId,MissionData,MissionId)

	-- if GetGameOpenById(1021)<=0 then
		-- return
	-- end

	-- if MissionData<=0 then
		
		-- LuaAllScenceM2Wrold(sceneId, "弱国任务开启", CHAT_PLANE_SCROLL, 1)
		-- LuaAllScenceM2Wrold(sceneId, "弱国任务开启", CHAT_LEFTDOWN, 1)
		-- LuaAllScenceM2Wrold(sceneId, "弱国任务开启", CHAT_MAIN_RIGHTDOWN, 1)
			
		-- SetCountryQuestData(sceneId, 0, CD_INDEX_RUOGUO_START_FLAG,1)

        -- 激活世界杯
        -- ToggleWorldCup( 1)
        -- WriteLog( 1, "World cup has been actived. " )
	-- end
end

function x310000_OnMoJunFlag(sceneId, guid, missionData)
	if missionData == getn(x310000_g_CreatePositions) then
		CreateMonster( sceneId, 3237, 128, 128, 1, 971, x310000_g_ScriptId, -1, 21, 60*60*1000, 0, "", "黄金家族的背叛者")
		local msg1 = "一位更可怕的魔君―海都大王出现在中兴府！"
		LuaAllScenceM2Wrold(sceneId, msg1, CHAT_PLANE_SCROLL, 1)
		LuaAllScenceM2Wrold(sceneId, msg1, CHAT_LEFTDOWN, 1)
		LuaAllScenceM2Wrold(sceneId, msg1, CHAT_MAIN_RIGHTDOWN, 1)

		SetCountryQuestData(sceneId, 0, CD_INDEX_MOJUN_KILL_COUNT, 0)
	end 
end

